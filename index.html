<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>마족/천족 선택형 게임 지도</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #0a0a0a; overflow: hidden; font-family: 'Malgun Gothic', sans-serif; }
        #map { width: 100vw; height: 100vh; background: #0a0a0a; }

        .leaflet-image-layer { will-change: transform; image-rendering: -webkit-optimize-contrast; }

        .layer-control {
            position: fixed; top: 20px; left: 20px;
            background: rgba(0, 0, 0, 0.85); padding: 20px;
            border-radius: 15px; color: white; z-index: 1000;
            border: 1px solid #444; backdrop-filter: blur(8px);
            min-width: 180px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        /* 진영 선택 버튼 */
        .faction-selector {
            display: flex; gap: 5px; margin-bottom: 20px;
            background: #222; padding: 5px; border-radius: 8px;
        }
        .faction-btn {
            flex: 1; padding: 10px; border: none; border-radius: 5px;
            cursor: pointer; font-weight: bold; color: #888; background: transparent;
            transition: 0.3s;
        }
        .faction-btn.active { background: #444; color: #fff; }
        .faction-btn.asmo.active { background: #b83b3b; color: white; }  /* 마족 빨간색 */
        .faction-btn.elyos.active { background: #4facfe; color: white; } /* 천족 파란색 */

        .item { display: flex; align-items: center; margin-bottom: 15px; cursor: pointer; font-size: 17px; }
        input[type="checkbox"] { margin-right: 12px; width: 22px; height: 22px; accent-color: #ff6b6b; }
    </style>
</head>
<body>

<div id="map"></div>

<div class="layer-control">
    <div class="faction-selector">
        <button class="faction-btn asmo active" onclick="changeFaction('asmo')">마족</button>
        <button class="faction-btn elyos" onclick="changeFaction('elyos')">천족</button>
    </div>

    <div style="margin-bottom: 12px; font-size: 13px; color: #aaa; border-bottom: 1px solid #444; padding-bottom: 5px;">몬스터 필터</div>
    <label class="item"><input type="checkbox" id="check-intellect" checked> 지성</label>
    <label class="item"><input type="checkbox" id="check-feral" checked> 야성</label>
    <label class="item"><input type="checkbox" id="check-nature" checked> 자연</label>
</div>

<script>
    const factions = {
        asmo: {
            base: 'asmo_base.webp',
            intellect: 'asmo_intellect.webp',
            feral: 'asmo_feral.webp',
            nature: 'asmo_nature.webp'
        },
        elyos: {
            base: 'elyos_base.webp',
            intellect: 'elyos_intellect.webp',
            feral: 'elyos_feral.webp',
            nature: 'elyos_nature.webp'
        }
    };

    // 초기 진영을 'asmo'(마족)로 설정
    let map, layers = {}, currentFaction = 'asmo';

    function initMap() {
        const img = new Image();
        img.src = factions[currentFaction].base;
        img.onload = function() {
            const w = this.naturalWidth;
            const h = this.naturalHeight;
            const bounds = [[0, 0], [h, w]];

            if (!map) {
                map = L.map('map', {
                    crs: L.CRS.Simple, minZoom: -3, maxZoom: 2,
                    zoomSnap: 0, preferCanvas: true, attributionControl: false
                });
            }

            // 레이어 초기화
            if (layers.base) map.removeLayer(layers.base);
            if (layers.intellect) map.removeLayer(layers.intellect);
            if (layers.feral) map.removeLayer(layers.feral);
            if (layers.nature) map.removeLayer(layers.nature);

            // 현재 진영 이미지 적용
            layers.base = L.imageOverlay(factions[currentFaction].base, bounds).addTo(map);
            layers.intellect = L.imageOverlay(factions[currentFaction].intellect, bounds);
            layers.feral = L.imageOverlay(factions[currentFaction].feral, bounds);
            layers.nature = L.imageOverlay(factions[currentFaction].nature, bounds);

            // 체크 상태 유지
            if (document.getElementById('check-intellect').checked) layers.intellect.addTo(map);
            if (document.getElementById('check-feral').checked) layers.feral.addTo(map);
            if (document.getElementById('check-nature').checked) layers.nature.addTo(map);

            map.fitBounds(bounds);
        };
    }

    function changeFaction(faction) {
        currentFaction = faction;
        document.querySelectorAll('.faction-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.faction-btn.${faction}`).classList.add('active');
        
        // 체크박스 강조 색상 변경 (디테일)
        const checkColor = faction === 'asmo' ? '#ff6b6b' : '#4facfe';
        document.querySelectorAll('input[type="checkbox"]').forEach(ck => ck.style.accentColor = checkColor);
        
        initMap();
    }

    function setupToggle(id, layerName) {
        document.getElementById(id).addEventListener('change', function(e) {
            if (e.target.checked) map.addLayer(layers[layerName]);
            else map.removeLayer(layers[layerName]);
        });
    }

    setupToggle('check-intellect', 'intellect');
    setupToggle('check-feral', 'feral');
    setupToggle('check-nature', 'nature');

    initMap();
</script>
</body>
</html>